<%*
// Get current date
const today = new Date().toISOString().split('T')[0];

// Create array containing "country" names
const folders = this.app.vault.getAllLoadedFiles()
  .filter(file => file.children && file.path.startsWith('Compendium/Locations/') && file.path.split('/').length === 3)
  .map(folder => folder.name);

// Get next session number
const sessionNotesRegex = /^Session Notes\/Session (\d+)/;
const files = this.app.vault.getMarkdownFiles()
  .reduce((maxNumber, file) => Math.max(maxNumber, (file.path.match(sessionNotesRegex) || [])[1] || 0), 0) + 1;

// Format session number if needed
const sessionNumber = files.toString().padStart(2, '0');

console.log(tp.file.title)
// Select country
const country = folders.length ? await tp.system.suggester(folders, folders, false, "Which country did today's session take place in?") : "";

// Rename file
const newNoteName = `Session ${sessionNumber} (${today})`;
await tp.file.rename(newNoteName);

// Open note in new tab
await app.workspace.getLeaf(true).openFile(tp.file.find_tfile(newNoteName));

// Finished Toast
new Notice().noticeEl.innerHTML = `<span style="color: green; font-weight: bold;">Finished!</span><br>New note <span style="text-decoration: underline;"></span> added`;

// Cancellation Toast
new Notice().noticeEl.innerHTML = `<span style="color: red; font-weight: bold;">Cancelled!</span><br>New note <span style="text-decoration: underline;"></span> added`;
_%>

---
type: notes
country: <% country %>
tag:
- 
headerLink: "[[Session <% sessionNumber %> (<% today %>)#|Session <% sessionNumber %> (<% today %>)]]"
banner: "![[session.png]]"
banner_y: 0.364
---

###### 
:fas_sun: *DAY XX*
___

